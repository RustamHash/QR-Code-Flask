{% extends "base.html" %}

{% block title %}–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ - –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —à–∞–±–ª–æ–Ω–æ–≤ –¥–ª—è –æ—Ñ–∏—Å–∞{% endblock %}

{% block content %}
<div class="card">
    <h2>üîç –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</h2>
    <p class="info-text">
        –ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ñ–æ—Ä–º–∞—Ç—ã: PNG, JPG, JPEG, GIF, BMP.
        –ï—Å–ª–∏ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤, –≤—Å–µ –æ–Ω–∏ –±—É–¥—É—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã.
    </p>
</div>

<form method="POST" enctype="multipart/form-data" id="decodeForm" action="{{ url_for('decode_qr') }}">
    <div class="form-group">
        <label for="file">–í—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏:</label>
        <input type="file" id="file" name="file" accept="image/*" required>
    </div>
    
    <div class="image-preview-container" id="previewContainer">
        <div class="image-preview">
            <img id="previewImage" src="" alt="–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä">
            <div class="preview-info" id="previewInfo"></div>
            <button type="button" class="preview-remove" id="removePreview">–£–¥–∞–ª–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</button>
        </div>
    </div>
    
    <button type="submit" class="btn" id="submitBtn">–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</button>
    <a href="{{ url_for('index') }}" class="btn btn-secondary" style="margin-left: 10px;">–ù–∞–∑–∞–¥</a>
</form>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const fileInput = document.getElementById('file');
        const previewContainer = document.getElementById('previewContainer');
        const previewImage = document.getElementById('previewImage');
        const previewInfo = document.getElementById('previewInfo');
        const removePreviewBtn = document.getElementById('removePreview');
        const submitBtn = document.getElementById('submitBtn');
        
        fileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            
            if (file) {
                if (!file.type.startsWith('image/')) {
                    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è');
                    fileInput.value = '';
                    return;
                }
                
                const maxSize = 20 * 1024 * 1024;
                if (file.size > maxSize) {
                    alert('–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 20MB');
                    fileInput.value = '';
                    return;
                }
                
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    previewImage.src = e.target.result;
                    previewContainer.classList.add('active');
                    
                    const fileSize = (file.size / 1024).toFixed(2);
                    previewInfo.textContent = `–§–∞–π–ª: ${file.name} (${fileSize} KB)`;
                    
                    previewContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                };
                
                reader.onerror = function() {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞');
                    fileInput.value = '';
                };
                
                reader.readAsDataURL(file);
            } else {
                previewContainer.classList.remove('active');
            }
        });
        
        removePreviewBtn.addEventListener('click', function() {
            fileInput.value = '';
            previewContainer.classList.remove('active');
            previewImage.src = '';
            previewInfo.textContent = '';
        });
        
        const form = document.getElementById('decodeForm');
        form.addEventListener('submit', function(e) {
            if (!fileInput.files || fileInput.files.length === 0) {
                e.preventDefault();
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ');
                return false;
            }
            
            submitBtn.disabled = true;
            submitBtn.textContent = '–û–±—Ä–∞–±–æ—Ç–∫–∞...';
        });
    });
</script>
{% endblock %}

